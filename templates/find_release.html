{% extends "base.html" %}
{% block title %}Find release{% endblock %}
{% block heading %}Find release{% endblock %}

{% block main %}

{% if state == "search" %}

<form method="POST" action="{{ url_for('find_release') }}">
    Query:
    <input class="form-control input-lg" type="text" name="query" placeholder="Search query, e.g. barcode or artist and album name"><br>
    <input type="submit" value="Go!">
</form>

{% elif state == "results" %}

<div class="table-responsive">
        <table class="table table-striped table-sm">
            <thead>
                <tr>
                    <th>#</th>
                    <th>Artist</th>
                    <th>Title</th>
                    <th>Format</th>
                    <th>Discogs Ref</th>
                </tr>
            </thead>
            <tbody>
                {% for e in results %}
                {% if e.type == "Release" %}
                <tr>
                    {% set ref=e.uri.split("/")[-1] %}
                    <td><a href="{{ url_for('check_release', reference=ref) }}">Click!  </a></td>
                    <td>{{ e.artist }}</td>
                    <td>{{ e.title }}</td>
                    <td>{{ e.format }}</td>
                    <td>{{ ref }}</td>
                </tr>
                {% endif %}
                {% endfor %}
            </tbody>
    
        </table>
    </div>


{% elif state == "check" %}

<div class="row">
<div class="col-md-8">
<h2>{{ release.artists[0].name }} - {{ release.title }} ({{ release.released_year }})</h2>
<h2><a href="{{ url_for('by_upload', discogs_ref=release.discogs_reference) }}" class="button">Use this release!</a></h2>

<b>Styles:</b>
{% for style in release.styles %}{{ style }}, {% endfor %}
<br><br>
<h5>Tracklist:</h5>
<div class="table-responsive col-md-12">
    <table class="table table-striped table-sm">
        <thead>
            <tr>
                <th>Pos</th>
                <th>Title</th>
                <th>Duration</th>
            </tr>
        </thead>
        <tbody>
            {% for track in release.tracklist %}
            {% if track.type == "track" %}
            <tr>
                <td>{{ track.position }}</td>
                <td>{{ track.title }}</td>
                <td>{{ track.duration }}</td>
            </tr>
            {% endif %}
            {% endfor %}
        </tbody>
    </table>
</div>

</div>
<div class="col-md-4">
Images:
{% for image in release.image_list %}
<img src="{{ image.thumb }}"></img><br>
{% endfor %}
</div>
</div>

{% endif %}

{% endblock %}


{% block sidebar %}
{% if state == "check" %}
<img class="col-md-12" src="{{ cover_image }}"/> 
{% endif %}
{% endblock %}